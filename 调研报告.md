# 任务调研报告

## 背景

该报告是基于[任务](https://github.com/jiuyewxy/weloveinterns/issues/50)所展开的报告。

## Cartographer 与 GMapping

这两者都是基于 SLAM（Simultaneous Localization and Mapping）算法，这个算法指的是定位与建图。
也就是机器人在运动的过程中通过不同的传感器收集到的信息来绘制地图的一个算法。

### 重要性

**为什么不用现有的地图而是要让机器人实时的建图？**
地图只能反馈一个基本的方位，但是不能反馈真实的物理环境，比如说真正的环境中会有不同的障碍物、不同的地势、不同地理环境（室内外等）。这些因素会影响实际的机器人任务执行。

同时，机器人的建图并不是永久性的，而是具有灵活性的，可以自己灵活根据环境中的变化而去修改地图。

机器人的建图也会根据不同的传感器所搜集的数据而对于这个地图去进行标注。

### 如何实现

SLAM 依赖 LiDAR（激光雷达）以及 IMU（惯性测量单位）。前者是每秒发送大量的激光束去探测实际的物理环境的距离以及角度，用于构建 2D 以及 3D 的地图。而 IMU 的作用主要是帮助机器人去感知自己的移动，比如说转弯以及倾斜，让机器人知道自己的姿态。

### 生成的地图

Cartographer 生成的地图分为 2D 以及 3D 的地图。2D 的地图是常见的俯视图地图，能够显示墙壁、障碍物等的位置。而 3D 地图会更加的详细，可以捕捉物体的高度以及形状，当然计算量都会更大。

### 为什么要从 GMapping 换成 Cartographer

GMapping 适用于简单的 2D SLAM，静态（例如室内）的环境，而 Cartographer 不仅能够生成 2D SLAM，而且支持 3D SLAM，可以结合多个传感器去动态、灵活的调整任务中遇到的问题。

### Cartographer 3D SLAM 基本流程

首先主要从两个主要的传感器获取数据：LiDAR、IMU。前者用于记录障碍物的位置和形状，后者用于保证机器人运动以及姿态，帮助修正地图。

## Cartographer

### 传感器数据不准确影响

如果传感器数据不正常，可能会导致障碍物的位置错误或者位置重叠、出现多的障碍物（无中生有）等。
且如果机器人使用了不准确的地图，可能会导致在导航的时候发生碰撞的风险。

### Cartographer 是如何保证数据准确性？

传感器数据融合，如上述的 LiDAR 以及 IMU 的数据进行融合，以及其他的传感器，将不同的数据融合起来保证数据准确性。
其次是食用了滤波器，如卡尔曼滤波器 (Kalman Filter)，粒子滤波器 (Particle Filter)。前者是辅助 IMU 处理数据，比如说 IMU 数据中的噪声和漂移都会被过滤掉。而后者一般是在不确定性高的时候用，比如说机器人在移动的时候会启用。

同时还会多次的进行采样，也就是不只是采取一次数据，而是多次采取的数据之后进行误差校正。

以及也会定期去校准传感器，保证传感器传输的数据是正确的。



## 配置

配置 Cartographer 主要是配置 `/scan`（激光雷达数据） `/imu` （IMU 数据），也就是将这两个数据正确的发布到 ROS2 话题上。
这些参数是在 Cartographer 的 .lua 文件中进行配置的。

